---
title: "Global assessment of evapotranspiration impacted by anthropogenic land cover changes"
author: Amir Mazrooei
date: "`r format(Sys.time(), '%B %Y')`"
output: html_document
---

```{r, eval=TRUE, echo=FALSE}
setwd("E:/Google Drive/NCSU-laptop sharing/Courses/Coursera_data_science/Developing Data Products/R Markdown Mapping & Leaflet")
Path_usefulGIS = "E:/Google Drive/NCSU-laptop sharing/Research/GIS/useful shapefiles"
Path_ETdata = "E:/Google Drive/NCSU-laptop sharing/Research/POWELL CENTER/Data/ET_LC/ET_GLOBAL_Worldsubdivs_Koppen/"
filename = paste0(Path_ETdata,"MatlabOutput_Global_DeltaET_Annual_mmperyear.txt")
filename_2 = paste0(Path_ETdata,"To_Join_Koppen_Codes_Names.txt")
```

### Introduction
Of all the moisture fluxes over the earth's surface, evapotranspiration (ET) is the largest outgoing flux in both arid and temperate regions.  However, due to anthropogenic activities, particularly human-altered landscapes, natural ET fluxes are significantly altered over urban settings. This results in amplified urban heat island (UHI) effects such as less evaporative cooling and thus increased surface temperature and energy demands. In this study, MODIS Land cover data and the Operational Simplified Surface Energy Balance (SSEBop) ET data at 1km resolution are exploited at a global scale, in order to derive the differences in ET fluxes over urban extents and surrounding non-urban extents within different climatic regions/divisions based on Koppen climate classification. Moreover, we consider a county-level analysis across the contiguous United States (CONUS) in order to attribute the ET changes to certain human factors particularly associated with water supply withdrawal from cities/towns. Findings show that ET is higher in non-urban (urban) settings in temperate and humid (semi-arid and arid) regions due to increased water availability. 

This research was supported by the United States Geological Survey (USGS) Powell Center Working Group Project "A global synthesis of land-surface fluxes under natural and human-altered watersheds using the Budyko framework". A manuscript of this project is prepared and submitted to PNAS and the dataset produced in this project is publicly available ([dataset link](https://github.com/amazroo/Urbanization_and_ET/raw/master/DATA_PNAS_ET_Paper.zip)).

---

---

<center> <h3>$\Delta ET = ET_{urban} - ET_{non-urban}$</h3> </center>

```{r, message= FALSE, warning= FALSE, fig.width=9.5, fig.height=8, echo=FALSE}
library(leaflet)
library(rgdal)
library(maptools)
library(plyr)
layer = readOGR(Path_usefulGIS, "Worldsubdivs_Koppen_simplified", verbose = FALSE)
layer@data$FID <- layer@data$FID_1
#layer@data$id <- rownames(layer@data)

DeltaET.data <- read.csv(filename, header=TRUE, sep=",")
#DeltaET.data$DeltaET_Annual_mmperyear = -DeltaET.data$DeltaET_Annual_mmperyear #\DeltaET = ET_{urban} - ET_{non-urban}
layer@data <- join(layer@data, DeltaET.data, by="FID")

Koppen_classes <- read.csv(filename_2 , header=TRUE, sep="\t")
layer@data <- join(layer@data, Koppen_classes, by="FID")

bins <- c(-9999,seq(-400,400,100),9999)
pal <- colorBin("RdBu", domain = layer@data$DeltaET_Annual_mmperyear, bins = bins, reverse = TRUE)

labels <- sprintf("<strong>Country:</strong> %s<br/><strong>Main Climate class:</strong> %s<br/><strong>Precipitation class:</strong> %s<br/><strong>Temperature class:</strong> %s<br/><strong>%s</strong> %g [mm/year]", layer@data$NAME, layer@data$Koppen_main_climate, layer@data$Koppen_precipitation, layer@data$Koppen_temperature, "&Delta;ET=", layer@data$DeltaET_Annual_mmperyear ) %>% lapply(htmltools::HTML)

leaflet(layer) %>% addProviderTiles("Esri.WorldTerrain") %>% setView(lng = 0, lat = 0, zoom = 2) %>%
  addPolygons(fillColor = ~pal(DeltaET_Annual_mmperyear), color = "gray", weight = 0.6, smoothFactor = 0.5, opacity = 1, dashArray = "3", fillOpacity = .71,
    highlightOptions = highlightOptions(color = "white", weight = 2,
    bringToFront = TRUE), label = labels, popup =labels ,
    labelOptions = labelOptions(style = list("font-weight" = "normal", padding = "2px 4px"),
    textsize = "15px", direction = "top")) %>%
  addLegend(pal = pal, values = ~layer@data$DeltaET_Annual_mmperyear, opacity = .71, title = "&Delta;ET [mm/year]", position = "bottomright")
```